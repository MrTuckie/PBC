/*
 By: Pedro Vinicius
 05/09/014 - Brazil
 Strobe for RC
 atmega328p

 "led" and "led2" are outputs
 "bot" is the button
 "state" is the LED state. indicates when "x" changes
*/
#define F_CPU 16000000UL
#include <avr/io.h>
#include <util/delay.h>
#define led  (1 << 1)
#define led2 (1 << 3)
#define bot  (1 << 4)
#define state (1 << 5)
int x = 0;
int main(void)
{
	DDRB |= led;
	DDRB |= led2;
	DDRB |= state;
	DDRB &= ~bot;
    while(1)
    {
		if (PINB & bot)
		{
			_delay_ms(500);
			if (PINB & bot)
			{
				x++;
				PORTB |= state;
				_delay_ms(100);
				PORTB &= ~state;
				_delay_ms(400);
				if (x == 4)
				{
					x = 0;
				}
			}
		}
		if (x == 1)
		{
		  PORTB |= led;
			_delay_ms(100);
			PORTB &= ~led;
			_delay_ms(100);
			PORTB |= led;
			_delay_ms(100);
			PORTB &= ~led;
			_delay_ms(100);
			PORTB |= led;
			_delay_ms(100);
			PORTB &= ~led;
			PORTB |= led2;
			_delay_ms(300);
			PORTB &= ~led2;
			_delay_ms(200);
			PORTB |= led2;
			_delay_ms(200);
			PORTB &= ~led2;
		}
		else if (x == 2)
		{
			PORTB ^= led2;
			_delay_ms(500);
			PORTB |= led;
			_delay_ms(250);
			PORTB &= ~led;
			_delay_ms(350);
		}
		else if (x == 3)
		{
			PORTB |= led;
			_delay_ms(100);
			PORTB |= led2;
			_delay_ms(100);
			PORTB &= ~led2;
			_delay_ms(100);
			PORTB &= ~led;
			_delay_ms(200);
		}

    }
}
